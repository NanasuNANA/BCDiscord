<!doctype HTML>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>BCDiscord for Browser</title>
<script type="text/JavaScript" src="lib/discord.io/index.js"></script> <!-- The discord.io client file -->
<script type="text/JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/JavaScript" src="config/config.js"></script>
<script type="text/JavaScript" src="bcdiscord.js"></script>
<script type="text/JavaScript">
$(() => {
    // UI
    resultSpan = $('#result');
    bcdiceApiUrlInput = $('#api_url');
    botTokenInput = $('#token');
    testStringInput = $('#test_string');
    apiTestButton = $('#api_test');
    connectButton = $('#connect_discord');
    
    // ローカルストレージから復元
    if (CONFIG.api_url) {
        bcdiceApiUrlInput.val(CONFIG.api_url);
        if (CONFIG.lock_url_input) {
            bcdiceApiUrlInput.attr('readonly', true);
        };
    } else if (localStorage.getItem(`${appName}_api_url`)) {
        bcdiceApiUrlInput.val(localStorage.getItem(`${appName}_api_url`));
    }
    if (localStorage.getItem(`${appName}_token`)) {
        botTokenInput.val(localStorage.getItem(`${appName}_token`));
    }
    if (localStorage.getItem(`${appName}_systemInfo`)) {
        try {
            systemInfo = JSON.parse(localStorage.getItem(`${appName}_systemInfo`));
        } catch (e) {
            systemInfo = {};
        }
    }
    if (localStorage.getItem(`${appName}_saveData`)) {
        try {
            saveData = JSON.parse(localStorage.getItem(`${appName}_saveData`));
        } catch(e) {
            saveData = {};
        }
    }
    
    // ローカルストレージからの全削除
    $('#reset_all').on('click', () => {
        if (!confirm('保存されたすべてのデータを削除しますか？')) {
            return false;
        }
        localStorage.removeItem(`${appName}_api_url`);
        localStorage.removeItem(`${appName}_token`);
        localStorage.removeItem(`${appName}_systemInfo`);
        localStorage.removeItem(`${appName}_saveData`);
        $('#main_form').get(0).reset();
        if (CONFIG.api_url) {
            bcdiceApiUrlInput.val(CONFIG.api_url);
        }
        return false;
    });
    
    // main
    main();
});
</script>
<style type="text/css">
body {max-width: 700px}
span.fail { color: red }
#connect_discord { font-size: 120%; font-weight: bold; padding: 0.6em 1.2em; width: 12em }
#reset_all { color: red; margin-top: 3.6em; float: right; font-size: 80%; background-color: transparent; border: 0px none }
#api_url[readonly=readonly] { border: none transparent }
</style>
</head>
<body>
<div>
<form onsubmit="return false;" id="main_form">
Discord Bot Token: <input type="password" size="80" inputmode="verbatim" id="token" placeholder="あなたのDiscord BotのToken"><br>
BCDice-API URL: <input type="url" size="60" id="api_url" placeholder="BCDice-APIのURL"><br>
<input type="text" size="40" id="test_string" inputmode="verbatim" placeholder="2D6+2>=7 など、空の場合はバージョン取得"> <input type="button" value="BCDice-APIのテスト" id="api_test"><br>
<span id="result"></span><br>
<input type="button" value="Discordに接続" id="connect_discord">
<input type="reset" value="全データの削除" id="reset_all">
</form>
</div>
</body>
</html>
